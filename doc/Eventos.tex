\documentclass[a4paper,9pt]{article}
\usepackage[a4paper]{geometry}
\geometry{top=0.5in, bottom=0.5in, left=0.5in, right=0.5in}
\usepackage{amsmath,amssymb,lmodern} 
\usepackage{cancel}
\usepackage{mathrsfs}
\usepackage{amsfonts}
\usepackage{fullpage}
\usepackage{enumerate}
\usepackage{graphicx}
\usepackage{hyperref}

\title{Generaci\'on de eventos.}
\author{Xaunther}

\begin{document}

\maketitle

\section{Introducci\'on}
En este documento se explica c\'omo funciona la parte central del simulador: el generador de eventos. Los eventos que ocurren durante el partido se generan de manera aleatoria, pero la probabilidad de que sucedan dependen de la habilidad de los equipos, su t\'actica, su formaci\'on, su condici\'on de local y su agresividad. En el futuro pueden añadirse otros factores como el estado del c\'esped, el \'arbitro, la cantidad de p\'ublico, el bonus del estadio...

Aqu\'i aparecer\'an explicadas con el mayor rigor posible los efectos de los diferentes condicionantes, y c\'omo tunear algunos de los par\'ametros de configuraci\'on para que el resultado sea lo m\'as equilibrado posible, es decir, no haya t\'acticas ni formaciones "overpowered" (OP).

\section{Esquema de funcionamiento}
Cada minuto de partido, y tambi\'en al inicio, se realizan los siguientes pasos:
\begin{enumerate}
\item Comprobar y realizar cambios t\'acticos.
\item Añadir minutos de juego a los jugadores.
\item Reducir fit de los jugadores.
\item Actualizar puntos de habilidad los equipos.
\item Simular el minuto de partido.
\item Lesiones aleatorias. Funcionamiento explicado en doc/Injuries.pdf
\item Comprobar y realizar cambios t\'acticos. Si ocurre un gol, lesi\'on, etc. primero se intentan usar las t\'acticas del DT.
\item Forzar cambios. En caso de lesiones o expulsi\'on del portero, el equipo debe reorganizarse autom\'aticamente para seguir jugando de manera realista, incluso si el DT no ha contemplado esta situaci\'on.
\end{enumerate}

\section{Valores de fuerza}
Los dos equipos tienen 4 valores de fuerza, correspondientes a: porter\'ia, defensa, pase y ataque. Estos valores se calculan a partir de las habilidades de los jugadores, t\'acticas, posiciones y otros factores. A m\'as alto es el valor de fuerza, mejor es ese equipo en esa parte del juego.
\section{Simulaci\'on}
La simulaci\'on es el \'unico elemento aleatorio de la lista (adem\'as de las lesiones que ya est\'an explicadas). En cuanto a la iniciaci\'on del partido, se realiza un sorteo para el saque, el cual determina qu\'e equipo empieza la posesi\'on en cada parte. Para todos los minutos de partido el esquema es el siguiente, y en caso afirmativo se pasa al siguiente n\'umero de la lista:
\begin{enumerate}
\item Determinar si el bal\'on cambia de dueño o no. Se mide el valor de pase del equipo con la posesi\'on ($P_A$) frente al valor de defensa del equipo que se defiende ($D_D$). Si el equipo en defensa consigue hacerse con la pelota las siguientes situaciones pueden darse:
\begin{itemize}
\item Robo y ocasi\'on (contraataque).
\item Robo
\item Falta (lejana, indirecta, directa o penalty) sin tarjeta, con amarilla o roja. Si es lejana, el atacante mantiene la pelota; si no, hay una ocasi\'on de gol a pelota parada.
\end{itemize}
\item Determinar si hay ocasi\'on de gol. Se mide el valor de ataque del atacante ($A_A$) frente al valor de defensa del equipo defensor ($D_D$). Si no, se mantiene la posici\'on.
\item Determinar el tipo de ocasi\'on (cu\'an buena es), y si es con o sin asistencia:
\begin{itemize}
\item Mano a mano vs portero.
\item Mano a mano vs defensa.
\item C\'orner
\item Chut cercano.
\item Chut lejano.
\end{itemize}
\item Determinar rematador, defensor y asistente. La probabilidad de a qui\'en le toca viene determinada por su posici\'on en el campo:
\begin{itemize}
\item Rematador: FW $>$ AM $>$ MF $>$ DM $>$ DF $>$ GK ($=0$).
\item Asistente: AM $>$ MF $>$ FW $>$ DM $>$ DF $>$ GK ($=0$).
 \item Defensor: DF $>$ DM $>$ MF $>$ AM $>$ FW $>$ GK ($=0$).
\end{itemize}
\item Determinar resultado de la acci\'on. Esto depende del valor de chut del rematador, pase del asistente, tackle del defensor y habilidad del portero.
\begin{itemize}
\item Gol.
\item Fallo pero c\'orner.
\item Fallo manteniendo posesi\'on.
\item Fallo perdiendo posesi\'on.
\end{itemize}
\end{enumerate}

\section{Esquema de probabilidad}
Aún sin conocer cómo se determina exactamente la probabilidad para cada evento, el anterior esquema de funcionamiento conlleva las siguientes relaciones de probabilidad, por minuto de juego:
\begin{align}
P(gol)&=P(posesion)\sum_i{P(gol|ocasion_i)P(ocasion_i|posesion)}\approx\frac{1}{90}
P(ocasion)&=P(posesion)\sum_i{P(ocasion_i|posesion)}\approx\frac{5}{90}
\end{align}
Los valores aproximados de probabilidad de gol y de ocasión pueden entenderse como una referencia cuando dos equipos de fuerzas parejas juegan un partido con tácticas neutras.

En cuanto a la probabilidad de posesión, ésta se calcula de manera aproximada usando una cadena de Markov en la \autoref{sec:ProbPosesion}
\section{Probabilidad de posesi\'on}\label{sec:ProbPosesion}
La probabilidad de posesión tras m minutos de juego puede expresarse como:
\begin{equation}
\vec{P}_m = T\vec{P}_{m-1} = T^m\vec{P}_{0}
\end{equation}
Donde $\vec{P}_m$ es el vector de probabilidades de que cada equipo tenga la posesión tras m minutos de juego y T es la matriz de transición (probabilidad de cada equipo de mantener la pelota y de perderla). En forma matricial se escribe como:
\begin{equation}
\begin{pmatrix}
P_m(L) \\
P_m(V)
\end{pmatrix}
=
\begin{pmatrix}
P(L) & 1-P(V) \\
1-P(L) & P(V)
\end{pmatrix}^m
\begin{pmatrix}
P_0(L) \\
P_0(V)
\end{pmatrix}
=
\begin{pmatrix}
P(L) & 1-P(V) \\
1-P(L) & P(V)
\end{pmatrix}^m
\frac{1}{2}\begin{pmatrix}
1 \\
1
\end{pmatrix}
\end{equation}
\end{document}